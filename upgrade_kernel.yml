---
hosts: k8s_cluster
vars: 
  kernel_version: "{{ ansible_kernel }}"
tasks:
- name: Update ELRepo Repository
  shell: |
    dnf update -y
    dnf install -y https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm
    rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
    dnf makecache
- name: Upgrade Kernel
  shell: |
    dnf --enablerepo="elrepo-kernel" install -y kernel-ml
- name: Reboot the machine
  reboot:
    reboot_timeout: 300
- name: Confirm kernel version
  shell: uname -a
  register: kernel_version
- debug: var=kernel_version.stdout
